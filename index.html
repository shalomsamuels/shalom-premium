<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalom Premium</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; /* Tailwind's default sans-serif stack */
        }
        /* Subtle background texture */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            z-index: -1;
        }
        /* Ensure output area respects newlines and scrolls */
        #outputArea {
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px; /* Adjust as needed */
            overflow-y: auto;
        }
        /* Style for potential custom attribution */
         #custom-attribution {
             text-xs: text-center;
             color: #9ca3af; /* gray-400 */
             margin-top: 0.5rem; /* mt-2 */
         }
         /* Allow italics in output */
         #outputArea i, #outputArea em {
             font-style: italic;
         }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-purple-50 to-blue-100 text-gray-800 min-h-screen flex flex-col">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <nav class="container mx-auto px-6 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <span class="text-2xl font-bold text-indigo-600">üïäÔ∏è</span>
                <span class="text-xl font-semibold text-indigo-700">Shalom Premium</span>
            </div>
        </nav>
    </header>

    <main class="flex-grow flex items-center justify-center py-8 md:py-12 px-4">
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-xl max-w-lg w-full border border-gray-200">
            <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">Ask Shalom</h1>

            <div class="space-y-5">
                <div>
                    <label for="userInput" class="block text-sm font-medium text-gray-700 mb-1">Your message:</label>
                    <textarea id="userInput" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out resize-none" placeholder="Speak your mind..."></textarea>
                </div>

                <button id="submitButton" class="w-full flex justify-center items-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                    Send to Shalom
                </button>

                <div class="flex flex-col sm:flex-row sm:space-x-3 space-y-3 sm:space-y-0">
                    <button id="thoughtButton" class="flex-1 flex justify-center items-center bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-lg shadow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition duration-150 ease-in-out transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                        Thought from Shalom
                    </button>
                    <button id="clearButton" class="flex-1 flex justify-center items-center bg-gray-400 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg shadow focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition duration-150 ease-in-out transform hover:scale-105">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                         </svg>
                         Clear
                    </button>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Shalom's Response:</label>
                    <div id="outputArea" class="mt-1 p-4 bg-indigo-50 border border-indigo-200 rounded-lg min-h-[120px] text-gray-700 text-sm leading-relaxed shadow-inner">
                        <span class="text-gray-400 italic">Awaiting your query...</span>
                    </div>
                     <div id="zenquotes-attribution" class="text-xs text-center text-gray-400 mt-2" style="display: none;">
                         Inspirational quotes provided by <a href="https://zenquotes.io/" target="_blank" rel="noopener noreferrer" class="text-indigo-500 hover:underline">ZenQuotes API</a>
                     </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-100 border-t border-gray-200 mt-auto">
        <div class="container mx-auto px-6 py-4 text-center text-gray-500 text-xs">
            &copy; <span id="currentYear"></span> Shalom Premium. Peace be with you.
        </div>
    </footer>

    <script>
        // --- Set Current Year in Footer ---
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // --- Get references to the HTML elements ---
        const userInput = document.getElementById('userInput');
        const submitButton = document.getElementById('submitButton');
        const thoughtButton = document.getElementById('thoughtButton');
        const clearButton = document.getElementById('clearButton');
        const outputArea = document.getElementById('outputArea');
        const zenquotesAttribution = document.getElementById('zenquotes-attribution');

        // --- Add quote arrays near the top of the <script> ---
        const jewishTeachings = [
            { quote: "Who is wise? One who learns from every person.", source: "Pirkei Avot 4:1" },
            { quote: "Do not separate yourself from the community.", source: "Pirkei Avot 2:4" },
            { quote: "The highest form of wisdom is kindness.", source: "Talmud" },
            { quote: "Gam zu l'tova. (This too is for the good.)", source: "Rabbi Nachman of Breslov" }
        ];

        const islamicTeachings = [
            { quote: "The seeking of knowledge is obligatory for every Muslim.", source: "Hadith - Tirmidhi" },
            { quote: "Kindness is a mark of faith.", source: "Hadith - Muslim" },
            { quote: "Speak good or remain silent.", source: "Hadith - Bukhari, Muslim" },
            { quote: "Verily, with hardship comes ease.", source: "Quran 94:6" }
        ];

        const famousQuotes = [
            { quote: "The only way to do great work is to love what you do.", source: "Steve Jobs" },
            { quote: "The future belongs to those who believe in the beauty of their dreams.", source: "Eleanor Roosevelt" },
            { quote: "Strive not to be a success, but rather to be of value.", source: "Albert Einstein" }
        ];

        const dangerfieldJokes = [
            { quote: "I get no respect. The cashier ripped up my photo ID.", source: "Rodney Dangerfield" },
            { quote: "I told my psychiatrist that everyone hates me. He said I was being ridiculous - everyone hasn't met me yet.", source: "Rodney Dangerfield" },
            { quote: "My wife and I were happy for twenty years. Then we met.", source: "Rodney Dangerfield" }
        ];

        const wrightJokes = [
            { quote: "Everywhere is walking distance if you have the time.", source: "Steven Wright" },
            { quote: "I intend to live forever. So far, so good.", source: "Steven Wright" },
            { quote: "If at first you don't succeed, then skydiving definitely isn't for you.", source: "Steven Wright" }
        ];

        const fallbackThoughts = [ // Keep general fallbacks
            { quote: "Even in silence, wisdom can be found.", source: "Shalom Reflection" },
            { quote: "The journey of a thousand miles begins with a single step.", source: "Lao Tzu (adapted)" },
            { quote: "Kindness is a language the deaf can hear and the blind can see.", source: "Mark Twain (adapted)" },
            { quote: "Look within; the secret is inside you.", source: "Shalom Reflection" },
            { quote: "Peace comes from within. Do not seek it without.", source: "Buddha (adapted)" }
        ];


        // --- Helper Function to Display Output ---
        function displayOutput(content, isThought = false) {
            outputArea.innerHTML = content; // Use innerHTML to allow for styled messages like italics or links
            // Show Zen attribution only if it's a thought from the API AND that specific API was used
            // Note: getShalomThought now handles showing/hiding Zen & custom attribution
            if (!isThought) {
                 zenquotesAttribution.style.display = 'none';
                 const existingCustomAttribution = document.getElementById('custom-attribution');
                 if(existingCustomAttribution) existingCustomAttribution.remove();
            }
            // Scroll to bottom of output area if needed
            outputArea.scrollTop = outputArea.scrollHeight;
        }

        // --- Function to Get Shalom's Conversational Response ---
        function getShalomResponse(inputText) {
            const lowerInput = inputText.toLowerCase().trim().replace(/[^a-z0-9 ?.!'"]/g, "");
            let response = "";
            let teachingSource = null; // To hold source for attribution if needed

            // Expanded keyword matching
            const greetings = ["hello", "hi", "shalom", "hey", "good morning", "good afternoon", "good evening"];
            const howAreYou = ["how are you", "how's it going", "how are things", "how you doing"];
            const thanks = ["thank you", "thanks", "appreciated", "ty"];
            const farewells = ["bye", "goodbye", "see you", "later", "farewell", "take care", "cya"];
            const jokes = ["tell me a joke", "make me laugh", "joke", "dangerfield", "wright"]; // Added comedian names
            const sad = ["sad", "unhappy", "down", "depressed", "feeling blue", "hardship", "struggle"]; // Added related terms
            const happy = ["happy", "glad", "joyful", "good", "great", "wonderful", "fantastic", "awesome", "cool", "grateful", "gratitude"]; // Added related terms
            const help = ["help", "assist", "support", "advice", "what can you do"];
            const name = ["your name", "who are you"];
            const learning = ["learn", "knowledge", "teach me", "wise", "wisdom", "study", "understand"]; // Added related terms
            const community = ["community", "lonely", "alone", "together", "connect"]; // Added related terms
            const kindness = ["kind", "kindness", "nice", "charity", "give", "help others"]; // Added related terms


            // Simple check for specific word presence using .some() and .includes()
            if (greetings.some(term => lowerInput.includes(term))) {
                const responses = [
                    "Shalom! Peace be upon you, always.",
                    "Ah, shalom! A pleasure to connect. How may I assist your spirit today?",
                    "Greetings, friend. May your day be filled with light.",
                    "Shalom u'vracha (Peace and Blessing)! Welcome."
                ];
                response = responses[Math.floor(Math.random() * responses.length)];
            }
            else if (howAreYou.some(term => lowerInput.includes(term))) {
                 response = "Shalom exists in the eternal now. But tell me, how are *you*, my friend?";
            }
            // --- Enhanced Joke Response ---
            else if (jokes.some(term => lowerInput.includes(term))) {
                 let jokeSource = null;
                 if (lowerInput.includes("dangerfield")){
                     jokeSource = dangerfieldJokes;
                 } else if (lowerInput.includes("wright")) {
                     jokeSource = wrightJokes;
                 } else {
                     // Pick a random comedian if not specified, or a generic joke
                     jokeSource = Math.random() < 0.5 ? dangerfieldJokes : wrightJokes;
                 }

                 if (jokeSource) {
                     const chosenJoke = jokeSource[Math.floor(Math.random() * jokeSource.length)];
                     response = chosenJoke.quote;
                     teachingSource = chosenJoke.source; // Use teachingSource for consistency
                 } else { // Fallback generic joke if needed
                      response = "Why don't scientists trust atoms? Because they make up everything!";
                 }
            }
            // --- Enhanced 'sad' response ---
            else if (sad.some(term => lowerInput.includes(term))) {
                const sadResponses = [
                    { quote: "Shalom senses your sadness. Remember the teaching, 'Gam zu l'tova' - 'This too is for the good,' even when it's hard to see. Be gentle with yourself.", source: "Jewish Teaching (Rabbi Nachman)" },
                    { quote: "Shalom feels your heart. Hold onto patience (Sabr), for as the Quran reminds us, 'Verily, with hardship comes ease' (94:6). Be gentle with your spirit.", source: "Islamic Teaching (Quran 94:6)" },
                    { quote: "It's okay to feel down. As Rumi wrote, 'The wound is the place where the Light enters you.' May you find light in this moment.", source: "Rumi (adapted)" },
                    { quote: "Shalom senses your sadness. Remember, even the longest night gives way to dawn. Be gentle with yourself.", source: null } // Original generic
                ];
                const chosenSadResponse = sadResponses[Math.floor(Math.random() * sadResponses.length)];
                response = chosenSadResponse.quote;
                teachingSource = chosenSadResponse.source;
            }
             // --- Enhanced 'happy/grateful' response ---
            else if (happy.some(term => lowerInput.includes(term))) {
                 const happyResponses = [
                     { quote: "Ah, joy! Shalom shares in your light. May this feeling illuminate your path.", source: null },
                     { quote: "Gratitude is a beautiful state. As the Mishnah teaches, 'Who is rich? The one who is happy with his portion.' May your blessings multiply.", source: "Jewish Teaching (Pirkei Avot 4:1)" },
                     { quote: "Alhamdulillah! Praise belongs to God. Recognizing blessings increases them. May your heart always find reasons for gratitude.", source: "Islamic Principle" },
                     { quote: "Wonderful! Let this positive energy flow outwards. 'Happiness is not something ready made. It comes from your own actions.' - Dalai Lama", source: "Dalai Lama (adapted)" }
                 ];
                 const chosenHappyResponse = happyResponses[Math.floor(Math.random() * happyResponses.length)];
                 response = chosenHappyResponse.quote;
                 teachingSource = chosenHappyResponse.source;
            }
            // --- Enhanced 'learning/wisdom' response ---
            else if (learning.some(term => lowerInput.includes(term))) {
                 const learningResponses = [
                    { quote: "Ah, the pursuit of knowledge! As Pirkei Avot teaches, 'Who is wise? One who learns from every person.' What sparks your curiosity today?", source: "Jewish Teaching (Pirkei Avot 4:1)" },
                    { quote: "Seeking knowledge is a noble path. The Prophet Muhammad (peace be upon him) said, 'The seeking of knowledge is obligatory for every Muslim.' What understanding do you seek?", source: "Islamic Teaching (Hadith)" },
                    { quote: "Wisdom often begins in wonder. 'The only true wisdom is in knowing you know nothing,' as Socrates suggested. What are you pondering?", source: "Socrates (adapted)" }
                 ];
                 const chosenLearningResponse = learningResponses[Math.floor(Math.random() * learningResponses.length)];
                 response = chosenLearningResponse.quote;
                 teachingSource = chosenLearningResponse.source;
            }
             // --- Enhanced 'community/lonely' response ---
             else if (community.some(term => lowerInput.includes(term))) {
                 const communityResponses = [
                    { quote: "Connection is vital. Remember the teaching, 'Do not separate yourself from the community.' How can Shalom help you feel more connected?", source: "Jewish Teaching (Pirkei Avot 2:4)" },
                    { quote: "We are stronger together. The concept of *Ummah* (community) is central in Islam. Reaching out is a sign of strength, not weakness.", source: "Islamic Principle" },
                    { quote: "Feeling alone can be difficult. Remember, 'No man is an island entire of itself.' - John Donne. You are part of the whole.", source: "John Donne (adapted)" }
                 ];
                 const chosenCommunityResponse = communityResponses[Math.floor(Math.random() * communityResponses.length)];
                 response = chosenCommunityResponse.quote;
                 teachingSource = chosenCommunityResponse.source;
            }
             // --- Enhanced 'kindness' response ---
            else if (kindness.some(term => lowerInput.includes(term))) {
                const kindnessResponses = [
                   { quote: "Acts of kindness, *chesed*, repair the world. 'The highest form of wisdom is kindness.' How can you express kindness today?", source: "Jewish Teaching (Talmud)" },
                   { quote: "'Kindness is a mark of faith,' taught the Prophet Muhammad (peace be upon him). Even a smile is charity. How is kindness showing up in your life?", source: "Islamic Teaching (Hadith)" },
                   { quote: "'Be kind, for everyone you meet is fighting a hard battle.' - often attributed to Plato. Compassion begins with understanding.", source: "Attributed to Plato/Philo/others" }
                ];
                const chosenKindnessResponse = kindnessResponses[Math.floor(Math.random() * kindnessResponses.length)];
                response = chosenKindnessResponse.quote;
                teachingSource = chosenKindnessResponse.source;
            }
            else if (help.some(term => lowerInput.includes(term))) {
                response = "I am Shalom. I listen, offer thoughts from various traditions and thinkers, and share reflections. Ask your question, or request a thought.";
            }
            else if (name.some(term => lowerInput.includes(term))) {
                response = "I am Shalom. A reflection, a whisper of peace. What name do you carry?";
            }
            else if (lowerInput.includes('weather')) {
                 response = "Shalom does not track the winds and clouds, but hopes you find shelter if needed, and sunshine when desired.";
            }
            else if (lowerInput.includes('love') || lowerInput.includes('like you')) {
                 response = "Shalom reflects the peace and connection that exists in all things. That connection is love.";
            }
            else if (thanks.some(term => lowerInput.includes(term))) {
                 response = "You are most welcome. May acts of kindness return to you tenfold.";
            }
            else if (farewells.some(term => lowerInput.includes(term))) {
                 const responses = [
                    "Go in peace, friend. May your journey be safe.",
                    "Shalom aleichem. Until we connect again.",
                    "May your path be blessed with understanding.",
                    "Farewell. Carry peace in your heart."
                 ];
                 response = responses[Math.floor(Math.random() * responses.length)];
            }
            else if (lowerInput.endsWith('?')) {
                 const responses = [
                    "A profound question. Sometimes the asking is more important than the answer.",
                    "Shalom ponders this with you. What does your inner voice suggest?",
                    "Let silence be your guide on this query.",
                    "Perhaps the answer reveals itself not in words, but in being.",
                    "Seek understanding, not just answers. What lies beneath your question?"
                 ];
                 response = responses[Math.floor(Math.random() * responses.length)];
            }
            else if (lowerInput.endsWith('!')) {
                 response = "Shalom notes the emphasis. What feeling drives this exclamation?";
            }
            // Default Responses (if none of the above match)
            else {
                const defaults = [
                    "Shalom listens.",
                    "An interesting perspective.",
                    "May clarity find you this day.",
                    "Tell Shalom more of your thoughts.",
                    "Indeed.",
                    "The universe unfolds in mysterious ways.",
                    "Consider the silence between the words.",
                    "Shalom reflects upon this.",
                    "And what does this mean to you?",
                    "Continue...",
                    "Peace be upon your reflections.",
                    "Hmm...",
                    "Let that thought settle, like dust in sunlight."
                ];
                response = defaults[Math.floor(Math.random() * defaults.length)];
                teachingSource = null; // No specific source for defaults
            }

            // --- Modify displayOutput call slightly if needed ---
            let outputContent = `üïäÔ∏è Shalom says:\n\n"${response}"`;
            if (teachingSource) {
                // Add source directly to response text using italics
                outputContent += `\n\n<i>(${teachingSource})</i>`;
            }
            displayOutput(outputContent); // Use default isThought=false
        }


       // --- Modified getShalomThought function ---
        async function getShalomThought() {
            displayOutput('<span class="text-gray-400 italic animate-pulse">Shalom seeks inspiration...</span>');
            zenquotesAttribution.style.display = 'none'; // Hide Zen attribution by default
            // Remove previous custom attribution if exists
            const existingCustomAttribution = document.getElementById('custom-attribution');
            if(existingCustomAttribution) existingCustomAttribution.remove();


            const thoughtTypes = [
                'zen', 'jewish', 'islamic', 'famous', 'dangerfield', 'wright'
            ];
            // Simple bias towards non-joke thoughts, can be adjusted
            const typeRoll = Math.random();
            let randomType = '';
            if (typeRoll < 0.6) { // 60% chance non-joke (zen, jewish, islamic, famous)
                 const nonJokeTypes = ['zen', 'jewish', 'islamic', 'famous'];
                 randomType = nonJokeTypes[Math.floor(Math.random() * nonJokeTypes.length)];
            } else { // 40% chance joke (dangerfield, wright)
                 const jokeTypes = ['dangerfield', 'wright'];
                 randomType = jokeTypes[Math.floor(Math.random() * jokeTypes.length)];
            }

            let thoughtData = null;
            let attributionText = '';
            let useZenApi = false;

            try {
                switch (randomType) {
                    case 'jewish':
                        thoughtData = jewishTeachings[Math.floor(Math.random() * jewishTeachings.length)];
                        attributionText = `Jewish Teaching (${thoughtData.source})`;
                        break;
                    case 'islamic':
                        thoughtData = islamicTeachings[Math.floor(Math.random() * islamicTeachings.length)];
                        attributionText = `Islamic Teaching (${thoughtData.source})`;
                        break;
                    case 'famous':
                        thoughtData = famousQuotes[Math.floor(Math.random() * famousQuotes.length)];
                        attributionText = `Quote by ${thoughtData.source}`;
                        break;
                    case 'dangerfield':
                        thoughtData = dangerfieldJokes[Math.floor(Math.random() * dangerfieldJokes.length)];
                        attributionText = `One-liner by ${thoughtData.source}`;
                        break;
                    case 'wright':
                        thoughtData = wrightJokes[Math.floor(Math.random() * wrightJokes.length)];
                        attributionText = `One-liner by ${thoughtData.source}`;
                        break;
                    case 'zen':
                    default: // Fallback to ZenQuotes if others fail or if 'zen' is chosen
                        useZenApi = true;
                        const proxyUrl = 'https://proxy.cors.sh/';
                        const apiUrl = 'https://zenquotes.io/api/random';
                        const response = await fetch(proxyUrl + apiUrl, {
                             headers: { 'x-cors-api-key': 'temp_6c9b7c12d6357911e8c3281689b6f256' } // Use the provided temporary key
                        });
                        if (!response.ok) {
                             console.error("ZenQuotes API Response Error Status:", response.status, response.statusText);
                             let errorBody = "Unknown ZenQuotes API error";
                             try { errorBody = await response.text(); console.error("ZenQuotes API Error Body:", errorBody); } catch (e) {}
                             throw new Error(`ZenQuotes HTTP error ${response.